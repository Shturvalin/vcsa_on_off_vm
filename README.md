–°–∫—Ä–∏–ø—Ç –¥–ª—è –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ –≤–∫–ª—é—á–µ–Ω–∏—è\–≤—ã–∫–ª—é—á–µ–Ω–∏—è —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞ –í–ú –Ω–∞ vCSA. –°–Ω–∞—á–∞–ª–∞ –≤—ã–≤–æ–¥–∏—Ç—Å—è —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∏–º–µ—é—â–∏—Ö—Å—è –í–ú, –ø–æ—Å–ª–µ —á–µ–≥–æ, –∏–¥–µ—Ç —Ü–∏–∫–ª–∏—á–Ω–æ–µ –≤–∫–ª—é—á–µ–Ω–∏–µ\–≤—ã–∫–ª—é—á–µ–Ω–∏–µ —É–∫–∞–∑–∞–Ω–Ω—ã—Ö id  –∑–∞–¥–∞–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–∞–∑.

üìú –ü–æ–ª–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞ —Å–∫—Ä–∏–ø—Ç–∞
üåê 1. –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –≤ vCenter
–§—É–Ω–∫—Ü–∏—è: get_auth_token()

–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:
üì° –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç POST-–∑–∞–ø—Ä–æ—Å –∫ /rest/com/vmware/cis/session.
üîê –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –ª–æ–≥–∏–Ω –∏ –ø–∞—Ä–æ–ª—å –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞ —Å–µ—Å—Å–∏–∏.
üõ†Ô∏è –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫: –í—ã–∑—ã–≤–∞–µ—Ç –∏—Å–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–∏ –Ω–µ—É–¥–∞—á–µ.

üñ•Ô∏è 3. –†–∞–±–æ—Ç–∞ —Å –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–º–∏ –º–∞—à–∏–Ω–∞–º–∏
–°–ø–∏—Å–æ–∫ –í–ú:
üìã list_vms(token) ‚Äî –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤—Å–µ –í–ú —á–µ—Ä–µ–∑ GET-–∑–∞–ø—Ä–æ—Å –∫ /rest/vcenter/vm.

–°—Ç–∞—Ç—É—Å –ø–∏—Ç–∞–Ω–∏—è:
üîå get_vm_power_state(token, vm_id) ‚Äî –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –≤–∫–ª—é—á–µ–Ω–∞ –∏–ª–∏ –≤—ã–∫–ª—é—á–µ–Ω–∞ –í–ú.

–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∏—Ç–∞–Ω–∏–µ–º:
üü¢ power_on_vm(token, vm_id) ‚Äî –í–∫–ª—é—á–∞–µ—Ç –í–ú —á–µ—Ä–µ–∑ POST-–∑–∞–ø—Ä–æ—Å –∫ /power/start.
üî¥ power_off_vm(token, vm_id) ‚Äî –í—ã–∫–ª—é—á–∞–µ—Ç –í–ú —á–µ—Ä–µ–∑ POST-–∑–∞–ø—Ä–æ—Å –∫ /power/stop.
‚úÖ –£—Å–ø–µ—à–Ω—ã–µ –∫–æ–¥—ã: 200 (OK), 204 (No Content).
‚ùå –û—à–∏–±–∫–∏: –õ–æ–≥–∏—Ä—É–µ—Ç –∏—Å–∫–ª—é—á–µ–Ω–∏—è —Å –¥–µ—Ç–∞–ª—è–º–∏ (–∫–æ–¥ –æ—Ç–≤–µ—Ç–∞, —Ç–µ–∫—Å—Ç).

üîÑ 4. –¶–∏–∫–ª–∏—á–µ—Å–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –í–ú
–§—É–Ω–∫—Ü–∏—è: manage_vms(token)

–õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã:

–ó–∞–ø—É—Å–∫ –í–ú:
‚ôªÔ∏è –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ –≤–∫–ª—é—á–µ–Ω–∏–µ –≤—Å–µ—Ö –í–ú —á–µ—Ä–µ–∑ ThreadPoolExecutor.
üßµ –î–ª—è –∫–∞–∂–¥–æ–π –í–ú —Å–æ–∑–¥–∞—ë—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω—ã–π –ø–æ—Ç–æ–∫.
üïí –û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤—Å–µ—Ö –∑–∞–¥–∞—á (as_completed).

–ü–∞—É–∑–∞:
‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ action_duration (60 —Å–µ–∫.).

–û—Å—Ç–∞–Ω–æ–≤–∫–∞ –í–ú:
‚ôªÔ∏è –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ –≤—ã–∫–ª—é—á–µ–Ω–∏–µ –≤—Å–µ—Ö –í–ú.

–ò–Ω—Ç–µ—Ä–≤–∞–ª:
‚è≤Ô∏è –ü–∞—É–∑–∞ action_interval (10 —Å–µ–∫.) –ø–µ—Ä–µ–¥ –Ω–æ–≤—ã–º —Ü–∏–∫–ª–æ–º.

–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:
üö® –õ–æ–≥–∏—Ä—É–µ—Ç –æ—à–∏–±–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–π –í–ú –±–µ–∑ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è —Ü–∏–∫–ª–∞.

üìä 5. –û—Å–Ω–æ–≤–Ω–æ–π –ø–æ—Ç–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
–§—É–Ω–∫—Ü–∏—è: main()

–≠—Ç–∞–ø—ã:

–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è: –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞.

–°–ø–∏—Å–æ–∫ –í–ú: –í—ã–≤–æ–¥ –≤—Å–µ—Ö –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –í–ú (ID + –∏–º—è).

–ó–∞–ø—É—Å–∫ —Ü–∏–∫–ª–∞: –í—ã–∑–æ–≤ manage_vms(token).

–ì–ª–æ–±–∞–ª—å–Ω—ã–µ –æ—à–∏–±–∫–∏: –ü–µ—Ä–µ—Ö–≤–∞—Ç –∏—Å–∫–ª—é—á–µ–Ω–∏–π –Ω–∞ —É—Ä–æ–≤–Ω–µ –≤—Å–µ–≥–æ —Å–∫—Ä–∏–ø—Ç–∞.

‚öôÔ∏è 6. –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏
–ú–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ—Å—Ç—å:
üßµ ThreadPoolExecutor —É—Å–∫–æ—Ä—è–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤–∫–ª—é—á–µ–Ω–∏—è/–≤—ã–∫–ª—é—á–µ–Ω–∏—è –í–ú.
üîÑ futures –∏ as_completed ‚Äî –∫–æ–Ω—Ç—Ä–æ–ª—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á.

–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:
üìù –í—ã–≤–æ–¥ —Å—Ç–∞—Ç—É—Å–æ–≤ –≤ –∫–æ–Ω—Å–æ–ª—å (—É—Å–ø–µ—Ö/–æ—à–∏–±–∫–∞).

–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å:
üõ°Ô∏è –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–π –Ω–∞ –≤—Å–µ—Ö —É—Ä–æ–≤–Ω—è—Ö (–æ—Ç API –¥–æ —Ü–∏–∫–ª–æ–≤).

üö® –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∏ —Ä–∏—Å–∫–∏
–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:
üîì –ü–∞—Ä–æ–ª—å –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –≤–∏–¥–µ ‚Äî —Ä–∏—Å–∫ —É—Ç–µ—á–∫–∏!
üîí –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ SSL ‚Äî –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω–æ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞.

–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:
‚ö†Ô∏è 3000 –∏—Ç–µ—Ä–∞—Ü–∏–π –º–æ–≥—É—Ç —Å–æ–∑–¥–∞—Ç—å –Ω–∞–≥—Ä—É–∑–∫—É –Ω–∞ vCenter.

–ù–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏:
‚ùå –ù–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ –í–ú —Å —É–∫–∞–∑–∞–Ω–Ω—ã–º–∏ ID.

üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è
–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:
üîë –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å .env –∏–ª–∏ Vault –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–∞—Ä–æ–ª—è.
üîê –í–∫–ª—é—á–∏—Ç—å SSL-–≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—é.

–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:
üìÇ –ü–∏—Å–∞—Ç—å –æ—à–∏–±–∫–∏ –≤ —Ñ–∞–π–ª, –∞ –Ω–µ —Ç–æ–ª—å–∫–æ –≤ –∫–æ–Ω—Å–æ–ª—å.

–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è:
‚è±Ô∏è –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É —Å—Ç–∞—Ç—É—Å–∞ –í–ú –ø–µ—Ä–µ–¥ –¥–µ–π—Å—Ç–≤–∏—è–º–∏ (—á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –ª–∏—à–Ω–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤).

–£–¥–æ–±—Å—Ç–≤–æ:
üñáÔ∏è –ü–∞—Ä—Å–∏—Ç—å vm_ids –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞ –∏–ª–∏ CLI-–∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤.

–û—Å—Ç–∞–Ω–æ–≤–∫–∞:
‚èπÔ∏è –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å graceful shutdown –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ Ctrl+C.

üéØ –¶–µ–ª—å —Å–∫—Ä–∏–ø—Ç–∞
–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å –Ω–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ vCenter –∏–ª–∏ –æ—Ç—Ä–∞–±–æ—Ç–∞—Ç—å —Å—Ü–µ–Ω–∞—Ä–∏–∏ –º–∞—Å—Å–æ–≤–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –í–ú (–Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è –∏–º–∏—Ç–∞—Ü–∏–∏ –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏).